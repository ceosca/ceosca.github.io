<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Video con Shaka Player</title>
    <!-- Incluye la biblioteca Shaka Player -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/3.0.3/shaka-player.compiled.js"></script>
</head>
<body>
    <!-- Contenedor del reproductor de video -->
    <div id="playerContainer" style="width: 640px; height: 360px;"></div>

    <script>
        // Función para inicializar y cargar el stream de video
        function cargarStream() {
            // URL del stream con cifrado "oct"
            const url = 'https://edge-mix02-mun.cvattv.com.ar/live/c7eds/Telemundo_HD/SA_Live_dash_enc_2A/Telemundo_HD.mpd';

            // Obtener las claves del enlace proporcionado
            fetch('https://listasm3u.live/arkey/Telemundo_HD.json')
                .then(response => response.json())
                .then(data => {
                    // Extraer las claves de cifrado del JSON
                    const keyId = data.keys[0].kid;
                    const key = data.keys[0].k;

                    // Configuración del reproductor Shaka Player
                    const player = new shaka.Player(document.getElementById('playerContainer'));
                    const drmConfiguration = {
                        servers: {
                            'com.widevine.alpha': 'https://widevine-proxy.appspot.com/proxy'
                        },
                        advanced: {
                            'com.widevine.alpha': {
                                audioRobustness: 'AABSLegacy',
                                videoRobustness: 'AABSLegacy',
                                distinctiveIdentifierRequired: false,
                                initDataTransformFunc: (initData) => {
                                    // Retornar el initData sin modificar
                                    return initData;
                                },
                                keyId: keyId,
                                key: key
                            }
                        }
                    };
                    player.configure({
                        drm: drmConfiguration
                    });

                    // Inicia la reproducción del video
                    player.load(url).then(function() {
                        console.log('El video se ha cargado correctamente.');
                    }).catch(onError);
                })
                .catch(onError);
        }

        // Maneja errores durante la carga o reproducción del video
        function onError(event) {
            console.error('Error de reproducción:', event.detail);
        }

        // Carga el stream de video al cargar la página
        window.onload = cargarStream;
    </script>
</body>
</html>
