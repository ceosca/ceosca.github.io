<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de MPD con cifrado oct</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.0.3/shaka-player.compiled.js"></script>
</head>
<body>
    <video id="videoPlayer" controls autoplay></video>

    <script>
        var mpdUrl = "https://edge-mix02-mun.cvattv.com.ar/live/c7eds/A3_Series/SA_Live_dash_enc_2A/A3_Series.mpd";
        var jsonUrl = "https://listasm3u.live/arkey/A3_Series.json";

        fetch(jsonUrl)
            .then(response => response.json())
            .then(data => {
                var key = data.keys[0].k;
                var keyId = data.keys[0].kid;

                var videoElement = document.getElementById('videoPlayer');
                var player = new shaka.Player(videoElement);

                player.configure({
                    drm: {
                        servers: {
                            'org.w3.clearkey': null
                        }
                    }
                });

                player.load(mpdUrl).then(function() {
                    console.log('El contenido se cargÃ³ correctamente!');
                }).catch(function(error) {
                    console.error('Error al cargar el contenido:', error);
                });

                // Configurar la clave de descifrado
                var config = {
                    'drm': {
                        'servers': {
                            'org.w3.clearkey': 'https://proxy.dashjs.org/widevine-proxy?url='
                        },
                        'clearKeys': {
                            '0x' + keyId: key
                        }
                    }
                };
                player.configure(config);
            })
            .catch(error => console.error('Error al cargar el JSON:', error));
    </script>
</body>
</html>
