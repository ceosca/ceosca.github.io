<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Series</title><style>html,body{margin:0;padding:0;box-sizing:border-box}:root{--primary-color:#4CAF50;--primary-color-dark:#3e8e41;--text-color:#333;--bg-color:#f4f4f4;--white:#fff;--shadow:0 0 5px rgba(0,0,0,.1);--focus-outline:3px solid #007bff;--focus-outline-offset:2px}body{font-family:Arial,sans-serif;background-color:var(--bg-color);font-size:1.2em;line-height:1.6;color:var(--text-color)}h2{font-size:1.8em;margin-bottom:.5em}.container{width:95%;margin:10px auto;background-color:var(--white);padding:15px;box-shadow:var(--shadow)}.button{padding:12px 18px;border:none;cursor:pointer;border-radius:5px;transition:background-color .2s ease,box-shadow .2s ease;font-size:1em;background-color:var(--primary-color);color:var(--white)}.button:hover,.button:focus{box-shadow:var(--shadow);outline:none}.button-primary:hover,.button-primary:focus{background-color:var(--primary-color-dark)}.series-list{list-style-type:none;padding:0}.series-list li{margin-bottom:10px}.series-list button{width:100%;text-align:left;font-size:1.1em;display:block}.modal{display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.7)}.modal-content{background-color:var(--white);margin:15% auto;padding:20px;border:1px solid #888;width:90%;position:relative;border-radius:10px;padding-top:60px;padding-bottom:70px}.fixed-header{position:fixed;top:0;left:0;width:100%;background-color:var(--white);padding:10px 20px;z-index:2;box-shadow:0 2px 5px rgba(0,0,0,.2);display:flex;justify-content:flex-end}.fixed-player{position:fixed;bottom:0;left:0;width:100%;background-color:#f0f0f0;padding:10px;text-align:center;z-index:2;box-shadow:0 -2px 5px rgba(0,0,0,.2);display:flex;justify-content:space-around;align-items:center}.fixed-player button{background-color:#555;color:var(--white);transition:background-color .3s;font-size:.9em;padding:8px 12px}.fixed-player button:hover{background-color:#777}.fixed-player #time-info,.fixed-player #chapter-info{font-size:.8em;color:var(--text-color)}#episodes-section,#languages-section{position:relative;margin-top:1em;display:flex;align-items:center}#episodes-button,#languages-button{position:absolute;left:0;top:0;z-index:3;padding:8px 12px;background-color:#007bff;color:var(--white);border:none;border-radius:5px;cursor:pointer}#episodes-content,#languages-content{width:100%;padding-left:100px}#episodes-content label,#languages-content label{display:block;margin-bottom:.5em;font-size:1.1em}#episodes-content select,#languages-content select{width:calc(100% - 10px);padding:10px;font-size:1em;border:1px solid #ccc;border-radius:5px;margin-bottom:1em}#languages-content select{appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px top 50%;background-size:1.5em}.episodes-container,.languages-container{width:100%}.hidden{display:none!important}*:focus{outline:var(--focus-outline);outline-offset:var(--focus-outline-offset)}@media (max-width:600px){body{font-size:1.1em}h2{font-size:1.5em}.container{padding:10px}.series-list button{padding:12px 15px;font-size:1em}.modal-content{margin:20% auto}}#continue-watching{margin-bottom:20px}#continue-watching h2{font-size:1.5em;margin-bottom:10px}#continue-watching ul{list-style:none;padding:0}#continue-watching li{margin-bottom:5px}</style></head><body><div class="container" id="main-container"><header><h2>Series de TV</h2><button id="google-sign-in" class="button">Iniciar sesión con Google</button><button id="sign-out" class="button hidden">Cerrar sesión</button></header><main><div id="continue-watching"><h2>Continuar escuchando</h2><ul id="cw-list"></ul></div><div id="countries-container"></div></main></div><div id="serieModal" class="modal" aria-hidden="true"><div class="modal-content" tabindex="-1"><header class="fixed-header"><button class="close button button-primary" id="closeModal">Regresar a explorar</button></header><main><div id="serie-info"></div><section id="episodes-section"><button id="episodes-button" class="button">Episodios</button><div class="episodes-container hidden" id="episodes-container"><div id="episodes-content"><label for="capitulo">Capítulo:</label><select id="capitulo"><option value="">Seleccionar</option></select></div></div></section><section id="languages-section" class="hidden"><button id="languages-button" class="button">Cambiar Pista de Audio</button><div class="languages-container hidden" id="languages-container"><div id="languages-content"><label for="language">Idioma:</label><select id="language"></select></div></div></section></main><audio id="audio-player">Audio no soportado.</audio><h2>Reproductor</h2><footer class="fixed-player"><button id="play-pause-button" class="button">Reproducir</button><button id="forward-button" class="button">Avanzar</button><button id="backward-button" class="button">Retroceder</button><button id="next-chapter-button" class="button">Siguiente episodio</button><button id="previous-chapter-button" class="button">Episodio anterior</button><button id="increase-volume-button" class="button">Subir volumen</button><button id="decrease-volume-button" class="button">Bajar volumen</button><div id="time-info"></div><div id="chapter-info"></div></footer></div></div><script type="module">import {initializeApp} from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";import {getFirestore,collection,doc,setDoc,getDoc,query,where,getDocs,serverTimestamp} from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";import {getAuth,signInWithPopup,GoogleAuthProvider,signOut,onAuthStateChanged} from "https://www.gstatic.com/firebasejs/11.5.0/firebase-auth.js";const firebaseConfig={apiKey:"AIzaSyAGzPA5b5P1NofFZtbBvGpuYE3tVR-JaS0",authDomain:"pfdsuaaug.firebaseapp.com",projectId:"pfdsuaaug",storageBucket:"pfdsuaaug.firebasestorage.app",messagingSenderId:"701797222900",appId:"1:701797222900:web:01836d45db1b35be2bd1a1"};const app=initializeApp(firebaseConfig);const db=getFirestore(app);const auth=getAuth(app);const googleProvider=new GoogleAuthProvider();const googleSignInButton=document.getElementById('google-sign-in');const signOutButton=document.getElementById('sign-out');const signInWithGoogle=async()=>{try{await signInWithPopup(auth,googleProvider)}catch{}};const signOutGoogle=async()=>{try{await signOut(auth)}catch{}};onAuthStateChanged(auth,(user)=>{if(user){googleSignInButton.classList.add('hidden');signOutButton.classList.remove('hidden')}else{googleSignInButton.classList.remove('hidden');signOutButton.classList.add('hidden')}UCW()});googleSignInButton.addEventListener('click',signInWithGoogle);signOutButton.addEventListener('click',signOutGoogle);const SD='https://ceosca.github.io/series/series.json',A=document.getElementById('audio-player'),MC=document.getElementById('main-container'),M=document.getElementById("serieModal"),CBC=document.getElementById("closeModal"),PB=document.getElementById('play-pause-button'),CS=document.getElementById('capitulo'),EC=document.getElementById('episodes-container'),EB=document.getElementById('episodes-button'),LC=document.getElementById('languages-container'),LS=document.getElementById('language'),LB=document.getElementById('languages-button'),LSect=document.getElementById('languages-section'),CI=document.getElementById('chapter-info'),TI=document.getElementById('time-info'),CWL=document.getElementById('cw-list');let TII,IP=!1,CSD=[],CLI=0,CCI=0,S;const V=(el,btn,s,h)=>(el.classList.contains('hidden')?(el.classList.remove('hidden'),btn.textContent=h):(el.classList.add('hidden'),btn.textContent=s)),FT=t=>{const m=Math.floor(t/60),s=Math.floor(t%60);return`${PZ(m)}:${PZ(s)}`},PZ=n=>(n<10?'0':'')+n;const GP=async(n)=>{if(!S||!n||A.readyState===0)return;const t=A.currentTime;if(isNaN(t)||t<5)return;try{const user=auth.currentUser;if(!user)return;const p={serieNombre:n,capituloIndex:CCI,tiempo:t,languageIndex:CLI,userId:user.uid,ultimaActualizacion:serverTimestamp()};const dR=doc(db,"progresoSeries",`${user.uid}_${n}`);await setDoc(dR,p,{merge:true});if(auth.currentUser)UCW()}catch{}};const RP=async(n)=>{try{const user=auth.currentUser;if(!user)return null;const dR=doc(db,"progresoSeries",`${user.uid}_${n}`);const dS=await getDoc(dR);if(dS.exists()){const data=dS.data();return{capituloIndex:data.capituloIndex||0,tiempo:data.tiempo||0,languageIndex:data.languageIndex}}else{return null}}catch{return null}};const C=()=>{S&&GP(S.nombre);M.style.display="none";A.pause();A.src='';MC.classList.remove('hidden');clearInterval(TII);IP=!1;PB.textContent='Reproducir';LSect.classList.add('hidden');LC.classList.add('hidden')};const O=async(s)=>{S=s;IP=!1;CLI=0;CCI=0;CSD=[];let sT=0;LS.innerHTML='';CS.innerHTML='<option value="">Seleccionar</option>';document.getElementById('serie-info').innerHTML='';CI.textContent='';TI.textContent='';LI(s);LL(s);if(s.enlaces&&s.enlaces.length>1){LSect.classList.remove('hidden');LC.classList.add('hidden');LB.textContent='Cambiar Pista de Audio'}else{LSect.classList.add('hidden')}const p=await RP(s.nombre);if(p){CCI=p.capituloIndex;sT=p.tiempo;LS.value=p.languageIndex!==undefined?p.languageIndex:0;CLI=parseInt(LS.value)}LCF(S,sT);MC.classList.add('hidden');M.style.display="block";const mC=document.querySelector('#serieModal .modal-content');if(mC)mC.focus()};const FD=async()=>{try{const t=await fetch(SD);if(!t.ok)throw new Error();const e=await t.json();return e.series}catch{return[]}};const RCAS=s=>{const t=document.getElementById('countries-container');t.innerHTML="";const e=[...new Set(s.map(s=>s.pais_origen))].sort();e.forEach(e=>{const n=document.createElement('h2');n.textContent=e;t.appendChild(n);const i=document.createElement('ul');i.classList.add('series-list');s.filter(s=>s.pais_origen===e).sort((a,b)=>a.nombre.localeCompare(b.nombre)).forEach(s=>{const el=document.createElement('li');const nb=document.createElement('button');nb.textContent=s.nombre;nb.addEventListener('click',()=>O(s));nb.setAttribute('tabindex','0');nb.classList.add('button');el.appendChild(nb);i.appendChild(el)});t.appendChild(i)});UCW()};const LI=s=>{const t=document.getElementById('serie-info');S=s;t.innerHTML=`<h2>${s.nombre}</h2><div><strong>Género:</strong> ${s.genero}</div><div><strong>Año:</strong> ${s.anio}</div><div><strong>Reparto:</strong> ${s.reparto.join(", ")}</div><div><strong>País:</strong> ${s.pais_origen}</div><div><strong>Episodios:</strong> ${s.cantidad_episodios}</div>${s.sinopsis?`<div><strong>Sinopsis:</strong> ${s.sinopsis}</div>`:''}`};const LL=s=>{LS.innerHTML='';s.enlaces.forEach((t,e)=>{const n=document.createElement('option');n.value=e;n.textContent=t.idioma;LS.appendChild(n)});/*LC visibility now handled by O*/};const LCF=(s,rT=0)=>{CS.innerHTML='';CSD=s.capitulos;CSD.forEach((t,e)=>{const n=document.createElement('option');n.value=e;n.textContent=t.titulo;CS.appendChild(n)});CS.value=CCI;UC();if(s.enlaces&&s.enlaces[CLI]){A.src=s.enlaces[CLI].enlace;A.load();const rP=()=>{A.currentTime=rT;A.play().then(()=>{IP=true;PB.textContent='Pausar'}).catch(()=>{IP=false;PB.textContent='Reproducir'});A.removeEventListener('loadedmetadata',rP)};A.addEventListener('loadedmetadata',rP);A.addEventListener('error',()=>{A.removeEventListener('loadedmetadata',rP);IP=false;PB.textContent='Reproducir'})}else{A.src='';IP=false;PB.textContent='Reproducir'}clearInterval(TII);UT();TII=setInterval(UT,1000)};const UC=()=>{if(CSD&&CSD[CCI]){CI.textContent=`Reproduciendo: ${CSD[CCI].titulo}`}else{CI.textContent=''}};const UT=()=>{if(!S||!CSD||CSD.length===0||!A)return;const t=A.currentTime;const d=A.duration;if(isNaN(d)||d===0){TI.textContent=`Tiempo: --:-- / --:--`;return}let cD="";if(CSD&&CSD[CCI]){cD=CSD[CCI].titulo}const cTF=FT(t);const tDF=FT(d);CI.textContent=IP?`Reproduciendo: ${cD}`:cD;TI.textContent=`Tiempo: ${cTF} / ${tDF}`};const TP=()=>{if(!A.src||A.src===window.location.href){if(S&&CSD&&CSD.length>0){PC()}return}if(IP){A.pause();IP=!1;PB.textContent='Reproducir';GP(S?.nombre)}else{A.play().then(()=>{IP=!0;PB.textContent='Pausar'}).catch(()=>{IP=!1;PB.textContent='Reproducir'})}};const F=()=>{A.currentTime=Math.min(A.duration||Infinity,A.currentTime+15)};const B=()=>{A.currentTime=Math.max(0,A.currentTime-15)};const TE=()=>{V(EC,EB,'Episodios','Ocultar')};const TL=()=>{V(LC,LB,'Cambiar Pista de Audio','Ocultar Pistas')};const PC=()=>{const sI=parseInt(CS.value);if(isNaN(sI)||!CSD||!CSD[sI])return;CCI=sI;if(S?.nombre)GP(S.nombre);if(CSD[CCI].inicio!==undefined){const sTS=CSD[CCI].inicio/1000;if(A.readyState<2){const pWR=()=>{A.currentTime=sTS;A.play().then(()=>{IP=true;PB.textContent='Pausar';UC()}).catch(()=>{});A.removeEventListener('canplay',pWR)};A.addEventListener('canplay',pWR)}else{A.currentTime=sTS;A.play().then(()=>{IP=true;PB.textContent='Pausar';UC()}).catch(()=>{IP=false;PB.textContent='Reproducir'})}}};const GCI=t_ms=>{let e=CCI;if(!CSD||CSD.length===0)return e;const t_s=typeof t_ms==='number'?t_ms/1000:A.currentTime;for(let i=0;i<CSD.length;i++){const c=CSD[i];const i_s=(typeof c.inicio==='number')?c.inicio/1000:-1;const f_s=(typeof c.fin==='number')?c.fin/1000:Infinity;if(i_s!==-1&&t_s>=i_s&&t_s<=f_s){e=i;break}}return e};const PP=()=>{let t=CCI;if(t>0){t--;CS.value=t;PC()}};const NP=()=>{let t=CCI;if(CSD&&t<CSD.length-1){t++;CS.value=t;PC()}};const CL=()=>{const cTBC=A.currentTime;CLI=parseInt(LS.value);if(isNaN(CLI))return;LCF(S,cTBC)};const IV=()=>{A.volume=Math.min(1,A.volume+.05)};const DV=()=>{A.volume=Math.max(0,A.volume-.05)};const UCW=async()=>{CWL.innerHTML='';try{const user=auth.currentUser;if(!user)return;const q=query(collection(db,"progresoSeries"),where("userId","==",user.uid),where("tiempo",">",10));const qS=await getDocs(q);const c=[];qS.forEach((doc)=>{c.push(doc.data())});const s=await FD();for(const t of c){const serie=s.find(e=>e.nombre===t.serieNombre);if(serie&&serie.capitulos&&serie.capitulos[t.capituloIndex]){const cap=serie.capitulos[t.capituloIndex];const fin=(typeof cap.fin==='number')?cap.fin/1000:A.duration;const tA=(typeof t.tiempo==='number')?t.tiempo:0;if(!isNaN(fin)&&fin>tA){const dR=FT(fin-tA);const li=document.createElement('li');const b=document.createElement('button');b.textContent=`Continuar ${serie.nombre}, ${cap.titulo}, Restante ${dR}`;b.addEventListener('click',()=>{O(serie)});b.classList.add('button');li.appendChild(b);CWL.appendChild(li)}}}}catch{}};CBC.addEventListener('click',C);window.addEventListener('click',t=>{t.target===M&&C()});CS.addEventListener('change',()=>{PC()});A.addEventListener('pause',()=>{if(IP){IP=!1;PB.textContent='Reproducir';GP(S?.nombre)}});A.addEventListener('play',()=>{IP=!0;PB.textContent='Pausar'});A.addEventListener('ended',()=>{IP=false;PB.textContent='Reproducir';GP(S?.nombre);NP()});EB.addEventListener('click',TE);LB.addEventListener('click',TL);LS.addEventListener('change',CL);PB.addEventListener('click',TP);document.getElementById('forward-button').addEventListener('click',F);document.getElementById('backward-button').addEventListener('click',B);document.getElementById('previous-chapter-button').addEventListener('click',PP);document.getElementById('next-chapter-button').addEventListener('click',NP);document.getElementById('increase-volume-button').addEventListener('click',IV);document.getElementById('decrease-volume-button').addEventListener('click',DV);window.onload=()=>{FD().then(s=>{if(s&&s.length>0){RCAS(s)}})};setInterval(()=>{if(M.style.display==="block"&&S&&IP){GP(S.nombre)}},15000);</script></body></html>